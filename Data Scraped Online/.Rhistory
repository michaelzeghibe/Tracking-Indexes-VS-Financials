results[[paste(asset1, asset2, "3Y", sep = "_")]] <- rolling_cor(monthly_returns, w3, asset1, asset2)
}
# Build data frame
n <- nrow(monthly_returns)
rolling_df <- monthly_returns %>% select(Date)
for (name in names(results)) {
vec <- results[[name]]
pad <- n - length(vec)
rolling_df[[name]] <- c(rep(NA, pad), vec)
}
plot_data <- rolling_df %>%
select(Date, starts_with("MAGS_")) %>%
pivot_longer(-Date, names_to = "Pair_Window", values_to = "Correlation") %>%
separate(Pair_Window, into = c("Pair", "Window"), sep = "_") %>%
filter(!is.na(Correlation)) %>%
mutate(Label = paste(Pair, Window, sep = " "))
ggplot(plot_data, aes(x = Date, y = Correlation, color = Label)) +
geom_line(linewidth = 0.95) +
facet_wrap(~ Pair, ncol = 2) +
labs(title = "Rolling Correlations with MAGS (Monthly)",
subtitle = "1-year (12 months), 2-year (24 months), 3-year (36 months) rolling windows",
x = "", y = "Correlation",
color = "Correlation Pair & Window") +
theme_minimal(base_size = 12) +
theme(legend.position = "bottom",
legend.title = element_text(face = "bold"),
strip.text = element_text(face = "bold")) +
scale_color_viridis_d(option = "plasma", end = 0.9) +
ylim(-1, 1)
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations - VOO
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations - VOO
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials/CODED WORK"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials/CODED WORK"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:\Users\micha\OneDrive - Providence College\Data Cap\Tracking-Indexes-VS-Financials\Data Scraped Online"
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- r"C:\Users\micha\OneDrive - Providence College\Data Cap\Tracking-Indexes-VS-Financials\Data Scraped Online"
# MONTHLY Rolling Correlations
library(readxl)
library(dplyr)
library(tidyr)
library(zoo)
library(ggplot2)
library(lubridate)
folder_path <- "C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials/Data Scraped Online"
read_price_sheet <- function(filename, asset_name) {
full_path <- file.path(folder_path, filename)
df <- read_excel(full_path, sheet = "Price History", skip = 2)
colnames(df)[1] <- "Date"
colnames(df)[2] <- asset_name
df <- df %>%
filter(!is.na(Date), !is.na(!!sym(asset_name))) %>%
mutate(Date = as.Date(as.numeric(Date), origin = "1899-12-30")) %>%
select(Date, all_of(asset_name)) %>%
arrange(Date)
return(df)
}
# Load data
arkk <- read_price_sheet("ARKK_PriceHistory.xlsx", "ARKK")
qqq  <- read_price_sheet("QQQ_PriceHistory.xlsx",  "QQQ")
voo  <- read_price_sheet("VOO_PriceHistory.xlsx",  "VOO")
mags <- read_price_sheet("MAGS_PriceHistory.xlsx", "MAGS")
vix  <- read_price_sheet("VIX_PriceHistory.xlsx",  "VIX")
# Merge (common period only)
prices <- arkk %>%
full_join(qqq,  by = "Date") %>%
full_join(voo,  by = "Date") %>%
full_join(mags, by = "Date") %>%
full_join(vix,  by = "Date") %>%
arrange(Date) %>%
filter(if_all(-Date, ~ !is.na(.)))
# Monthly
monthly_prices <- prices %>%
mutate(Month = floor_date(Date, "month")) %>%
group_by(Month) %>%
summarise(across(-Date, ~ last(.)), .groups = "drop") %>%
rename(Date = Month)
monthly_returns <- monthly_prices %>%
mutate(across(-Date, ~ c(NA, diff(log(.))))) %>%
drop_na()
# Rolling correlation
rolling_cor <- function(data, width, col1, col2) {
rollapply(data[, c(col1, col2)], width = width,
FUN = function(x) {
if (nrow(na.omit(x)) < 6) return(NA)
cor(x[,1], x[,2], use = "complete.obs")
},
by.column = FALSE, align = "right", fill = NA)
}
w1 <- 12; w2 <- 24; w3 <- 36
pairs <- list(
c("ARKK", "QQQ"), c("ARKK", "VOO"), c("ARKK", "MAGS"), c("ARKK", "VIX"),
c("QQQ", "VOO"), c("QQQ", "MAGS"), c("VOO", "MAGS")
)
results <- list()
for (p in pairs) {
asset1 <- p[1]; asset2 <- p[2]
results[[paste(asset1, asset2, "1Y", sep = "_")]] <- rolling_cor(monthly_returns, w1, asset1, asset2)
results[[paste(asset1, asset2, "2Y", sep = "_")]] <- rolling_cor(monthly_returns, w2, asset1, asset2)
results[[paste(asset1, asset2, "3Y", sep = "_")]] <- rolling_cor(monthly_returns, w3, asset1, asset2)
}
# Build data frame
n <- nrow(monthly_returns)
rolling_df <- monthly_returns %>% select(Date)
for (name in names(results)) {
vec <- results[[name]]
pad <- n - length(vec)
rolling_df[[name]] <- c(rep(NA, pad), vec)
}
plot_data <- rolling_df %>%
select(Date, starts_with("ARKK_")) %>%
pivot_longer(-Date, names_to = "Pair_Window", values_to = "Correlation") %>%
separate(Pair_Window, into = c("Pair", "Window"), sep = "_") %>%
filter(!is.na(Correlation)) %>%
mutate(Label = paste(Pair, Window, sep = " "))   # Clear label for legend
ggplot(plot_data, aes(x = Date, y = Correlation, color = Label)) +
geom_line(linewidth = 0.95) +
facet_wrap(~ Pair, ncol = 2) +
labs(title = "Rolling Correlations with ARKK (Monthly)",
subtitle = "1-year (12 months), 2-year (24 months), 3-year (36 months) rolling windows",
x = "", y = "Correlation",
color = "Correlation Pair & Window") +
theme_minimal(base_size = 12) +
theme(legend.position = "bottom",
legend.title = element_text(face = "bold"),
strip.text = element_text(face = "bold")) +
scale_color_viridis_d(option = "plasma", end = 0.9) +   # Nice distinct colors
ylim(-1, 1)
# Export
write.csv(rolling_df, "rolling_correlations_monthly_labeled.csv", row.names = FALSE)
list.files("data_raw")
install.packages(c("readxl","dplyr","tidyr","stringr","lubridate","purrr","ggplot2"))
list.files("data_raw")
install.packages(c("readxl","dplyr","tidyr","stringr","lubridate","purrr","ggplot2"))
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
library(purrr)
library(ggplot2)
setwd("C:/Users/ccorren2/OneDrive - Providence College/Data science Capstone CSC485/ETF tracking Folder - Connor, Mike")
list.files("data_raw")
install.packages(c("readxl","dplyr","tidyr","stringr","lubridate","purrr","ggplot2"))
list.files("data_raw")
install.packages(c("readxl","dplyr","tidyr","stringr","lubridate","purrr","ggplot2"))
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
library(purrr)
library(ggplot2)
setwd("C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials/Data Scraped Online")
voo  <- read_excel("VOO_PriceHistory.xlsx")
qqq  <- read_excel("QQQ_PriceHistory.xlsx")
arkk <- read_excel("ARKK_PriceHistory.xlsx")
mags <- read_excel("MAGS_PriceHistory.xlsx")
get_monthly_log_returns <- function(df, ticker){
# standardize column names
names(df) <- names(df) |>
stringr::str_trim() |>
stringr::str_to_lower() |>
stringr::str_replace_all("[^a-z0-9]+", "_") |>
stringr::str_replace_all("_$", "")
# --- find date column robustly ---
date_candidates <- grep("^date$", names(df), value = TRUE)
if (length(date_candidates) == 0) {
# sometimes it's like "timestamp" or "trading_date"
date_candidates <- grep("date", names(df), value = TRUE)
}
if (length(date_candidates) == 0) stop(paste("No date-like column found for", ticker))
date_col <- date_candidates[1]
# --- find price column robustly ---
# Prefer "adj...close" then fallback to "close" then fallback to anything with "price"
adj_candidates   <- grep("adj.*close", names(df), value = TRUE)
close_candidates <- grep("^close$|close$", names(df), value = TRUE)
price_candidates <- grep("price|last", names(df), value = TRUE)
price_col <- NA_character_
if (length(adj_candidates) > 0) {
price_col <- adj_candidates[1]
} else if (length(close_candidates) > 0) {
price_col <- close_candidates[1]
} else if (length(price_candidates) > 0) {
price_col <- price_candidates[1]
}
if (is.na(price_col)) {
stop(paste(
"No usable price column found for", ticker,
"\nColumns are:\n", paste(names(df), collapse = ", ")
))
}
df2 <- df |>
dplyr::mutate(
date  = as.Date(.data[[date_col]]),
price = as.numeric(.data[[price_col]]),
month = lubridate::floor_date(date, "month")
) |>
dplyr::select(date, month, price) |>
dplyr::arrange(date) |>
dplyr::filter(!is.na(date), !is.na(price))
# month-end price -> monthly log return
monthly <- df2 |>
dplyr::group_by(month) |>
dplyr::summarise(price_month_end = price[which.max(date)], .groups = "drop") |>
dplyr::arrange(month) |>
dplyr::mutate(
ticker = ticker,
log_ret_month = log(price_month_end / dplyr::lag(price_month_end))
) |>
dplyr::filter(!is.na(log_ret_month)) |>
dplyr::select(month, ticker, log_ret_month)
monthly
}
ret_m_long <- dplyr::bind_rows(
get_monthly_log_returns(voo,  "VOO"),
get_monthly_log_returns(qqq,  "QQQ"),
get_monthly_log_returns(arkk, "ARKK"),
get_monthly_log_returns(mags, "MAGS")
)
list.files("data_raw")
install.packages(c("readxl","dplyr","tidyr","stringr","lubridate","purrr","ggplot2"))
library(readxl)
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
library(purrr)
library(ggplot2)
setwd("C:/Users/micha/OneDrive - Providence College/Data Cap/Tracking-Indexes-VS-Financials/Data Scraped Online")
voo  <- read_excel("VOO_PriceHistory.xlsx")
qqq  <- read_excel("QQQ_PriceHistory.xlsx")
arkk <- read_excel("ARKK_PriceHistory.xlsx")
mags <- read_excel("MAGS_PriceHistory.xlsx")
get_monthly_log_returns <- function(df, ticker){
# standardize column names
names(df) <- names(df) |>
stringr::str_trim() |>
stringr::str_to_lower() |>
stringr::str_replace_all("[^a-z0-9]+", "_") |>
stringr::str_replace_all("_$", "")
# --- find date column robustly ---
date_candidates <- grep("^date$", names(df), value = TRUE)
if (length(date_candidates) == 0) {
# sometimes it's like "timestamp" or "trading_date"
date_candidates <- grep("date", names(df), value = TRUE)
}
if (length(date_candidates) == 0) stop(paste("No date-like column found for", ticker))
date_col <- date_candidates[1]
# --- find price column robustly ---
# Prefer "adj...close" then fallback to "close" then fallback to anything with "price"
adj_candidates   <- grep("adj.*close", names(df), value = TRUE)
close_candidates <- grep("^close$|close$", names(df), value = TRUE)
price_candidates <- grep("price|last", names(df), value = TRUE)
price_col <- NA_character_
if (length(adj_candidates) > 0) {
price_col <- adj_candidates[1]
} else if (length(close_candidates) > 0) {
price_col <- close_candidates[1]
} else if (length(price_candidates) > 0) {
price_col <- price_candidates[1]
}
if (is.na(price_col)) {
stop(paste(
"No usable price column found for", ticker,
"\nColumns are:\n", paste(names(df), collapse = ", ")
))
}
df2 <- df |>
dplyr::mutate(
date  = as.Date(.data[[date_col]]),
price = as.numeric(.data[[price_col]]),
month = lubridate::floor_date(date, "month")
) |>
dplyr::select(date, month, price) |>
dplyr::arrange(date) |>
dplyr::filter(!is.na(date), !is.na(price))
# month-end price -> monthly log return
monthly <- df2 |>
dplyr::group_by(month) |>
dplyr::summarise(price_month_end = price[which.max(date)], .groups = "drop") |>
dplyr::arrange(month) |>
dplyr::mutate(
ticker = ticker,
log_ret_month = log(price_month_end / dplyr::lag(price_month_end))
) |>
dplyr::filter(!is.na(log_ret_month)) |>
dplyr::select(month, ticker, log_ret_month)
monthly
}
ret_m_long <- dplyr::bind_rows(
get_monthly_log_returns(voo,  "VOO"),
get_monthly_log_returns(qqq,  "QQQ"),
get_monthly_log_returns(arkk, "ARKK"),
get_monthly_log_returns(mags, "MAGS")
)
